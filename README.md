# 华为2021软件精英挑战赛
## 赛题
### 首先给定实际物理服务器的参数，包括cpu核心数量、内存数量、购买价格、日常能耗。服务器资源平均分布在A、B两个结点上。
![截图2](https://user-images.githubusercontent.com/48812036/126594645-c4c105c4-47c9-4b99-ae9a-0355ee265208.png)
### 给出虚拟机类型，所需CPU和内存数量，和部署方式。
![截图3](https://user-images.githubusercontent.com/48812036/126594650-a20b1fdd-799a-443c-a551-3a97f4ed388f.png)
### 顺序处理所有部署请求，不能超出物理服务器容量上限，每天可以迁移一部分虚拟机，若使得某台物理服务器上不存在虚拟机，则该服务器将不产生日常能耗。总成本由一次性购买成本和日常能耗构成，越低越好。
![截图4](https://user-images.githubusercontent.com/48812036/126594653-a6c25e78-d46c-4ac3-a44a-5acbec1237ec.png)
![截图5](https://user-images.githubusercontent.com/48812036/126594657-10260b26-434e-441e-bba1-9629548ab36b.png)

## 整体方案
1. 读取当天的请求和删除信息。
2. 服务器性价比排序。
3. 迁移：用堆维护所有服务器的虚拟机数量，每次从少的服务器开始迁移，直到所有达到迁移上限或者非空服务器都比较满。
4. 处理新增：先处理双结点请求，再处理单节点请求。按cpu+mem从大到小排序。
<br/>能放置到已有的服务器中：比较所有服务器的适应度函数：f = (服务器剩余总资源 - 该虚拟机的资源)/(服务器总资源)，选择适应度函数最小的服务器放置。
<br/>不能放置到已有的服务器：购买一台能满足当前虚拟机硬件需求的性价比最高的机器。
5. 处理删除：修改已有服务器的挂载信息就行了
6. 将购买和迁移信息修改为标准输出格式

## 赛事总结
最终成绩为西北赛区第八。冲进过前四，以为自己行了，发现只是大佬在休息而已。
<br/>程序里面还有好多方法，包括迁移的组合优化，性价比的其他排序方法，其他的适应度函数，迁移的加速表等等。
<br/>最后演变成调参大赛，`Solution.cpp`开头的参数才是上分秘籍。

## 编译运行：
### windows用户：
1. 切换到`CodeCraft-2021`目录
2. ```g++ -o ./bin/CodeCraft-2021.exe *.cpp```
3. ```./bin/CodeCraft-2021.exe```
### vscode：
1. 修改`tasks.json`中的`command`为本地的`g++.exe`路径，`launch.json`中的`miDebuggerPath`为本地的`gdb.exe`路径。
2. 打开`CodeCraft-2021.cpp`,`Ctrl + Shift + B`编译，在`bin`文件夹下会生成exe文件。
3. `F5`运行exe。
### Linux:
1. 切换到`CodeCraft-2021`目录
2. ```g++ -o ./bin/CodeCraft-2021 *.cpp```
3. ```./bin/CodeCraft-2021```

## 结果：
运行成功后会在控制台打印如下信息：
![截图1](https://user-images.githubusercontent.com/48812036/126593981-79933b9d-7dcc-4e8e-8819-da7e2fa106f6.png)

<br/>每行代表一天的信息，依次为：天数、购买成本、日常能耗、处理时间、迁移次数、新增虚拟机数量、删除虚拟机数量、当天总虚拟机数量。
<br/>在工作目录会生成`output.txt`, 表示购买和调度方案。
